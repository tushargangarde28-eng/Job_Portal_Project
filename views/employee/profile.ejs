<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Profile | Job Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background-color: #f9fafc;
    }

    .card {
      border-radius: 0.75rem;
    }

    .profile-img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border: 3px solid #0d6efd;
    }

    .section-title {
      border-left: 4px solid #0d6efd;
      padding-left: 10px;
      margin-bottom: 1rem;
      font-weight: 600;
      color: #0d6efd;
    }

    .progress {
      height: 12px;
      border-radius: 10px;
    }

    .progress-bar {
      background: linear-gradient(90deg, #0d6efd, #4dabf7);
    }

    .btn-group-gap button {
      margin-left: 0.5rem;
    }
  </style>

</head>

<body>
  <%- include('navbar.ejs') %>

    <div class="container my-5">
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="card shadow-sm border-0">
            <div class="card-body p-4">

              <!-- Basic Info -->
              <div class="text-center mb-4">
                <img src="<%= employee[0].profile_photo && employee[0].profile_photo.trim() !== '' 
          ? '/employee_profile/' + employee[0].profile_photo 
          : 'https://www.iconpacks.net/icons/2/free-user-icon-3296-thumb.png' %>" alt="Profile Picture"
                  class="profile-img shadow-sm">
                <h4 class="mt-3 fw-bold text-primary"><%- employee[0].employee_name %></h4>
                <p class="text-muted mb-1"><i class="bi bi-geo-alt me-1"></i> <%- employee[0].employee_address %></p>
                <p class="text-muted"><i class="bi bi-envelope me-1"></i> <%- employee[0].employee_email %></p>
              </div>

              <!-- Profile Completion -->
              <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="fw-semibold text-secondary">
                    <i class="bi bi-graph-up-arrow text-success me-1"></i> Profile Strength
                  </span>
                  <span class="fw-bold" id="profileValue">
                    <%= profile_completion %>%
                  </span>
                </div>

                <div class="progress" style="height: 14px;">
                  <div class="progress-bar progress-bar-striped progress-bar-animated" id="profileBar"
                    style="width: <%= profile_completion %>%; background-color: #28a745;" role="progressbar"
                    aria-valuenow="<%= profile_completion %>" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>

              <script>
                // Optional dynamic color feedback (e.g., red -> yellow -> green)
                const completion = <%= profile_completion %>;
                const bar = document.getElementById('profileBar');
                if (completion < 40) bar.style.backgroundColor = '#dc3545';
                else if (completion < 75) bar.style.backgroundColor = '#ffc107';
                else bar.style.backgroundColor = '#28a745';
              </script>

              <hr>

              <!-- Personal Info -->
              <h5 class="section-title"><i class="bi bi-person-lines-fill me-1"></i> Personal Information</h5>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="fw-semibold text-muted">Full Name</label>
                  <div><%- employee[0].employee_name %></div>
                </div>
                <div class="col-md-6">
                  <label class="fw-semibold text-muted">Phone</label>
                  <div><%- employee[0].employee_mobile %></div>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="fw-semibold text-muted">Email</label>
                  <div><%- employee[0].employee_email %></div>
                </div>
                <div class="col-md-6">
                  <label class="fw-semibold text-muted">Address</label>
                  <div><%- employee[0].employee_address %></div>
                </div>
              </div>
              <div class="text-end mb-4">
                <a href="/employee/edit_employee_personal" class="btn btn-outline-primary">
                  <i class="bi bi-pencil me-1"></i> Edit Personal Details
                </a>
              </div>

              <!-- Skills -->
              <h5 class="section-title"><i class="bi bi-lightning-charge-fill me-1"></i> Skills</h5>
              <div class="mb-2">
                <% if (skills && skills.length> 0) { %>
                  <% skills.forEach(skill=> { %>
                    <span class="badge bg-warning text-dark me-1 mb-1">
                      <%= skill.skill_name %>
                    </span>
                    <% }) %>
                      <% } else { %>
                        <span class="text-muted">No skills added yet</span>
                        <% } %>
              </div>
              <div class="text-end btn-group-gap mb-4">
                <a href="/employee/add_employee_skills" class="btn btn-outline-success">
                  <i class="bi bi-plus me-1"></i> Add Skills
                </a>
                <a href="/employee/edit_employee_skills" class="btn btn-outline-primary">
                  <i class="bi bi-pencil me-1"></i> Edit Skills
                </a>
              </div>

              <!-- Education -->
              <h5 class="section-title"><i class="bi bi-mortarboard-fill me-1"></i> Education</h5>
              <div class="table-responsive mb-3">
                <table class="table table-bordered align-middle">
                  <thead class="table-light">
                    <tr>
                      <th>College Name</th>
                      <th>Course Title</th>
                      <th>Passing Year</th>
                      <th>Marks</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if (education && education.length> 0) { %>
                      <% education.forEach(edu=> { %>
                        <tr>
                          <td><%- edu.college_name %></td>
                          <td><%- edu.course_title %></td>
                          <td><%- edu.passing_year %></td>
                          <td><%- edu.marks %></td>
                          <td><%- edu.status %></td>
                          <td class="text-center">
                            <a href="/employee/edit_employee_education/<%- edu.education_id %>"
                              class="btn btn-outline-primary btn-sm me-2">
                              <i class="bi bi-pencil"></i>
                            </a>
                            <a href="/employee/delete_employee_education/<%- edu.education_id %>"
                              class="btn btn-outline-danger btn-sm"
                              onclick="return confirm('Are you sure you want to delete this education record?');">
                              <i class="bi bi-trash"></i>
                            </a>
                          </td>
                        </tr>
                        <% }) %>
                          <% } else { %>
                            <tr>
                              <td colspan="6" class="text-center text-muted">No education records found</td>
                            </tr>
                            <% } %>
                  </tbody>
                </table>
              </div>
              <div class="text-end mb-4">
                <a href="/employee/add_employee_education" class="btn btn-outline-success">
                  <i class="bi bi-plus me-1"></i> Add Education
                </a>
              </div>

              <!-- Experience -->
              <h5 class="section-title"><i class="bi bi-briefcase-fill me-1"></i> Experience</h5>
              <% if (experience && experience.length> 0) { %>
                <ul class="list-group mb-3">
                  <% experience.forEach(exp=> { %>
                    <li class="list-group-item border-0 border-start border-primary border-3 mb-2">
                      <div class="fw-semibold">
                        <%- exp.job_title %> â€” <span class="text-muted"><%- exp.company_name %></span>
                      </div>
                      <small class="text-muted"><%- exp.start_date %> - <%- exp.end_date || 'Present' %></small>
                      <p class="mt-1 mb-2"><%- exp.description || '' %></p>
                      <div class="text-end">
                        <a href="/employee/edit_employee_experience/<%- exp.experience_id %>"
                          class="btn btn-outline-primary btn-sm me-2">
                          <i class="bi bi-pencil"></i> Edit
                        </a>
                        <a href="/employee/delete_employee_experience/<%- exp.experience_id %>"
                          class="btn btn-outline-danger btn-sm"
                          onclick="return confirm('Are you sure you want to delete this experience record?');">
                          <i class="bi bi-trash"></i> Delete
                        </a>
                      </div>
                    </li>
                    <% }) %>
                </ul>
                <% } else { %>
                  <div class="text-muted fst-italic mb-3">No experience added yet.</div>
                  <% } %>
                    <div class="text-end mb-4">
                      <a href="/employee/add_employee_experience" class="btn btn-outline-success">
                        <i class="bi bi-plus me-1"></i> Add Experience
                      </a>
                    </div>

                    <!-- Resume -->
                    <h5 class="section-title"><i class="bi bi-file-earmark-person-fill me-1"></i> Resume</h5>
                    <div class="text-end mb-4">
                      <% if (employee && employee[0].employee_resume) { %>
                        <a href="<%= '/employee_resume/' + employee[0].employee_resume %>" target="_blank"
                          class="btn btn-outline-primary me-2">
                          <i class="bi bi-file-earmark-text me-1"></i> View Resume
                        </a>
                        <a href="/employee/delete_resume/<%= employee[0].employee_id %>" class="btn btn-outline-danger"
                          onclick="return confirm('Are you sure you want to delete your resume?');">
                          <i class="bi bi-trash me-1"></i> Delete Resume
                        </a>
                        <% } else { %>
                          <button class="btn btn-outline-secondary" disabled>
                            <i class="bi bi-file-earmark-x me-1"></i> No Resume Uploaded
                          </button>
                          <% } %>
                    </div>

                    <!-- Back Button -->
                    <div class="text-end">
                      <a href="/employee/" class="btn btn-secondary px-4">
                        <i class="bi bi-arrow-left-circle me-1"></i> Back to Dashboard
                      </a>
                    </div>

            </div>
          </div>
        </div>
        ```

      </div>
    </div>

    <%- include('footer.ejs') %>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>